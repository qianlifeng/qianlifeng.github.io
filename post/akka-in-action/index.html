<!doctype html><html lang=en><head><meta charset=utf-8><meta name=generator content="Hugo 0.79.1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content><meta property="og:url" content="https://blog.qlf.io/post/akka-in-action/"><link rel=canonical href=https://blog.qlf.io/post/akka-in-action/><link rel=preload href=/js/highlight.pack.js as=script><link rel=alternate type=application/atom+xml href=https://blog.qlf.ioindex.xml title="Scott Qian"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.qlf.io"},"articleSection":"post","name":"Akka in action","headline":"Akka in action","description":"AKKA 起步 本文使用 Maven 作为依赖管理工具。新建一个最基本的 Maven console 项目，并在 pom.xml 中加入如下依赖：\n\u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.typesafe.akka\u0026lt;\/groupId\u0026gt; \u0026lt;artifactId\u0026gt;akka-actor_2.10\u0026lt;\/artifactId\u0026gt; \u0026lt;version\u0026gt;2.3.12\u0026lt;\/version\u0026gt; \u0026lt;\/dependency\u0026gt; \u0026lt;\/dependencies\u0026gt; 新建一个UserActor。Actor 是一个封装了状态和行为的 Java 对象，Actor 之间通过交换消息来进行通信。\nimport akka.actor.UntypedActor; import akka.event.Logging; import akka.event.LoggingAdapter; public class UserActor extends UntypedActor { LoggingAdapter log = Logging.getLogger(getContext().system(), this); public void onReceive(Object message) throws Exception { log.info(\u0026#34;Received String message: {}\u0026#34;, message); getSender().tell(\u0026#34;got it\u0026#34;, getSelf()); } } 在Main方法中新建ActorSystem，并向UserActor发送消息\nimport akka.actor.ActorRef; import akka.actor.ActorSystem; import akka.actor.Props; public class App { public static void main(String[] args) { final ActorSystem system = ActorSystem.","inLanguage":"en-US","author":"","creator":"","publisher":"","accountablePerson":"","copyrightHolder":"","copyrightYear":"2015","datePublished":"2015-09-08 16:35:17 \u002b0000 UTC","dateModified":"2015-09-08 16:35:17 \u002b0000 UTC","url":"https:\/\/blog.qlf.io\/post\/akka-in-action\/","keywords":[]}</script><title>Akka in action - Scott Qian</title><meta property="og:title" content="Akka in action - Scott Qian"><meta property="og:type" content="article"><meta property="og:description" content="AKKA 起步 本文使用 Maven 作为依赖管理工具。新建一个最基本的 Maven console 项目，并在 pom.xml 中加入如下依赖：
<dependencies> <dependency> <groupId>com.typesafe.akka</groupId> <artifactId>akka-actor_2.10</artifactId> <version>2.3.12</version> </dependency> </dependencies> 新建一个UserActor。Actor 是一个封装了状态和行为的 Java 对象，Actor 之间通过交换消息来进行通信。
import akka.actor.UntypedActor; import akka.event.Logging; import akka.event.LoggingAdapter; public class UserActor extends UntypedActor { LoggingAdapter log = Logging.getLogger(getContext().system(), this); public void onReceive(Object message) throws Exception { log.info(&#34;Received String message: {}&#34;, message); getSender().tell(&#34;got it&#34;, getSelf()); } } 在Main方法中新建ActorSystem，并向UserActor发送消息
import akka.actor.ActorRef; import akka.actor.ActorSystem; import akka.actor.Props; public class App { public static void main(String[] args) { final ActorSystem system = ActorSystem."><meta name=description content="AKKA 起步 本文使用 Maven 作为依赖管理工具。新建一个最基本的 Maven console 项目，并在 pom.xml 中加入如下依赖：
<dependencies> <dependency> <groupId>com.typesafe.akka</groupId> <artifactId>akka-actor_2.10</artifactId> <version>2.3.12</version> </dependency> </dependencies> 新建一个UserActor。Actor 是一个封装了状态和行为的 Java 对象，Actor 之间通过交换消息来进行通信。
import akka.actor.UntypedActor; import akka.event.Logging; import akka.event.LoggingAdapter; public class UserActor extends UntypedActor { LoggingAdapter log = Logging.getLogger(getContext().system(), this); public void onReceive(Object message) throws Exception { log.info(&#34;Received String message: {}&#34;, message); getSender().tell(&#34;got it&#34;, getSelf()); } } 在Main方法中新建ActorSystem，并向UserActor发送消息
import akka.actor.ActorRef; import akka.actor.ActorSystem; import akka.actor.Props; public class App { public static void main(String[] args) { final ActorSystem system = ActorSystem."><meta property="og:locale" content><link rel=stylesheet href=/css/flexboxgrid-6.3.1.min.css><link rel=stylesheet href=/css/github-markdown.css><link rel=stylesheet href=/css/highlight/tomorrow.min.css><link rel=stylesheet href=/css/index.css><link href=/index.xml rel=alternate type=application/rss+xml title="Scott Qian"><link href="https://fonts.googleapis.com/css?family=Arvo|Permanent+Marker|Bree+Serif" rel=stylesheet></head><body><article class=post id=article><div class=row><div class=col-xs-12><div class=site-header><header><div class="signatures site-title"><a href=/>Scott Qian</a></div></header><div class="row end-xs"></div><div class=header-line></div></div><header class=post-header><h1 class=post-title>Akka in action</h1><div class="row post-desc"><div class=col-xs-6><time class=post-date datetime="2015-09-08 16:35:17 UTC">08 Sep 2015</time></div><div class=col-xs-6></div></div></header><div class="post-content markdown-body"><h1 id=akka-起步>AKKA 起步</h1><p>本文使用 Maven 作为依赖管理工具。新建一个最基本的 Maven console 项目，并在 pom.xml 中加入如下依赖：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;dependencies&gt;</span>
    <span style=color:#f92672>&lt;dependency&gt;</span>
        <span style=color:#f92672>&lt;groupId&gt;</span>com.typesafe.akka<span style=color:#f92672>&lt;/groupId&gt;</span>
        <span style=color:#f92672>&lt;artifactId&gt;</span>akka-actor_2.10<span style=color:#f92672>&lt;/artifactId&gt;</span>
        <span style=color:#f92672>&lt;version&gt;</span>2.3.12<span style=color:#f92672>&lt;/version&gt;</span>
    <span style=color:#f92672>&lt;/dependency&gt;</span>
<span style=color:#f92672>&lt;/dependencies&gt;</span>
</code></pre></div><p>新建一个<code>UserActor</code>。Actor 是一个封装了状态和行为的 Java 对象，Actor 之间通过交换消息来进行通信。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Java data-lang=Java><span style=color:#f92672>import</span> akka.actor.UntypedActor<span style=color:#f92672>;</span>
<span style=color:#f92672>import</span> akka.event.Logging<span style=color:#f92672>;</span>
<span style=color:#f92672>import</span> akka.event.LoggingAdapter<span style=color:#f92672>;</span>

<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserActor</span> <span style=color:#66d9ef>extends</span> UntypedActor <span style=color:#f92672>{</span>
    LoggingAdapter log <span style=color:#f92672>=</span> Logging<span style=color:#f92672>.</span><span style=color:#a6e22e>getLogger</span><span style=color:#f92672>(</span>getContext<span style=color:#f92672>().</span><span style=color:#a6e22e>system</span><span style=color:#f92672>(),</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>);</span>

    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onReceive</span><span style=color:#f92672>(</span>Object message<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> Exception <span style=color:#f92672>{</span>
        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Received String message: {}&#34;</span><span style=color:#f92672>,</span> message<span style=color:#f92672>);</span>
        getSender<span style=color:#f92672>().</span><span style=color:#a6e22e>tell</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;got it&#34;</span><span style=color:#f92672>,</span> getSelf<span style=color:#f92672>());</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>在<code>Main</code>方法中新建<code>ActorSystem</code>，并向<code>UserActor</code>发送消息</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Java data-lang=Java><span style=color:#f92672>import</span> akka.actor.ActorRef<span style=color:#f92672>;</span>
<span style=color:#f92672>import</span> akka.actor.ActorSystem<span style=color:#f92672>;</span>
<span style=color:#f92672>import</span> akka.actor.Props<span style=color:#f92672>;</span>

<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>App</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>String<span style=color:#f92672>[]</span> args<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>final</span> ActorSystem system <span style=color:#f92672>=</span> ActorSystem<span style=color:#f92672>.</span><span style=color:#a6e22e>create</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;ActorSystem&#34;</span><span style=color:#f92672>);</span>
        <span style=color:#66d9ef>final</span> ActorRef myActor <span style=color:#f92672>=</span> system<span style=color:#f92672>.</span><span style=color:#a6e22e>actorOf</span><span style=color:#f92672>(</span>Props<span style=color:#f92672>.</span><span style=color:#a6e22e>create</span><span style=color:#f92672>(</span>UserActor<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>));</span>
        myActor<span style=color:#f92672>.</span><span style=color:#a6e22e>tell</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;hello world&#34;</span><span style=color:#f92672>,</span> ActorRef<span style=color:#f92672>.</span><span style=color:#a6e22e>noSender</span><span style=color:#f92672>());</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>可以把<code>ActorSystem</code>想象成一个 Actor 组织，所有的 Actor 活动都在这个组织下进行，包括 Actor 的创建。 一个<code>ActorSystem</code>会创建 1-N 个线程来真正执行的 Actor 任务。<code>ActorSystem</code>的创建是一个比较消耗 资源的过程，因此最好在一个逻辑程序中只创建一个<code>ActorSystem</code>。<br><code>Actor</code>模型的设计原则是尽可能的对外界屏蔽<code>Actor</code>的具体实现，因此这里我们使用<code>system.actorOf</code>得到了一个<code>Actor</code>的引用，这样就屏蔽了 Actor 的内部细节。</p><p>运行此程序，如果一切顺利可以看到如下输出，代表发送消息成功：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml>[INFO] [09/08/2015 16:44:52.482] [ActorSystem-akka.actor.default-dispatcher-3] [akka://ActorSystem/user/$a] Received String message: hello world
</code></pre></div><p>如果你愿意，上面这个模型你可以当本地多线程来用。</p><h1 id=远程-actor>远程 Actor</h1><p>如果使用默认配置，ActorSystem 会创建基于<code>LocalActorRefProvider</code>的 Actor，即只在本地传递的 Actor。与此对应的，我们还可以创建一个 remote 的 Actor，这种 Actor 可以被远程调用，比如从另一个 JVM 中。<br>要启用远程 Actor，需要再创建<code>ActorSystem</code>的时候传入一些额外的配置。下面以一个简单的例子做说明。假如我们有两个系统 A,B。B 需要调用 A 系统上面的 Actor。</p><p>首先在 A,B 的 maven 依赖中加入额外的 akka-remote 引用：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;dependency&gt;</span>
         <span style=color:#f92672>&lt;groupId&gt;</span>com.typesafe.akka<span style=color:#f92672>&lt;/groupId&gt;</span>
         <span style=color:#f92672>&lt;artifactId&gt;</span>akka-remote_2.10<span style=color:#f92672>&lt;/artifactId&gt;</span>
         <span style=color:#f92672>&lt;version&gt;</span>2.3.12<span style=color:#f92672>&lt;/version&gt;</span>
<span style=color:#f92672>&lt;/dependency&gt;</span>
</code></pre></div><p>在 A 中，启用 remote 并创建一个 Actor：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Java data-lang=Java><span style=color:#f92672>import</span> akka.actor.ActorSystem<span style=color:#f92672>;</span>
<span style=color:#f92672>import</span> akka.actor.Props<span style=color:#f92672>;</span>
<span style=color:#f92672>import</span> com.typesafe.config.Config<span style=color:#f92672>;</span>
<span style=color:#f92672>import</span> com.typesafe.config.ConfigFactory<span style=color:#f92672>;</span>

<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>App</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>String<span style=color:#f92672>[]</span> args<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        Config combined <span style=color:#f92672>=</span> ConfigFactory<span style=color:#f92672>.</span><span style=color:#a6e22e>load</span><span style=color:#f92672>();</span>

        Config remote <span style=color:#f92672>=</span> ConfigFactory<span style=color:#f92672>.</span><span style=color:#a6e22e>parseString</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;akka.actor.provider=akka.remote.RemoteActorRefProvider&#34;</span><span style=color:#f92672>);</span>
        combined <span style=color:#f92672>=</span> remote<span style=color:#f92672>.</span><span style=color:#a6e22e>withFallback</span><span style=color:#f92672>(</span>combined<span style=color:#f92672>);</span>

        <span style=color:#75715e>//配置监听地址和端口，hostname可以忽略，默认为本机地址。port如果填写0，则为随机端口
</span><span style=color:#75715e></span>        Config addressConfig <span style=color:#f92672>=</span> ConfigFactory<span style=color:#f92672>.</span><span style=color:#a6e22e>parseString</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;akka.remote.netty.tcp={hostname=192.168.8.136, port=2552}&#34;</span><span style=color:#f92672>);</span>
        combined <span style=color:#f92672>=</span> addressConfig<span style=color:#f92672>.</span><span style=color:#a6e22e>withFallback</span><span style=color:#f92672>(</span>combined<span style=color:#f92672>);</span>

        <span style=color:#66d9ef>final</span> ActorSystem system <span style=color:#f92672>=</span> ActorSystem<span style=color:#f92672>.</span><span style=color:#a6e22e>create</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;ActorSystemA&#34;</span><span style=color:#f92672>,</span> combined<span style=color:#f92672>);</span>

        <span style=color:#75715e>//创建名字为ActorA的Actor
</span><span style=color:#75715e></span>        system<span style=color:#f92672>.</span><span style=color:#a6e22e>actorOf</span><span style=color:#f92672>(</span>Props<span style=color:#f92672>.</span><span style=color:#a6e22e>create</span><span style=color:#f92672>(</span>UserActor<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>),</span> <span style=color:#e6db74>&#34;ActorA&#34;</span><span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>在 B 中，同样的启用 remote，但是不需要创建任何 Actor，直接通过<code>actorSelection</code>直接选择 A 中的 Actor 路径即可</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Java data-lang=Java><span style=color:#f92672>import</span> akka.actor.ActorRef<span style=color:#f92672>;</span>
<span style=color:#f92672>import</span> akka.actor.ActorSelection<span style=color:#f92672>;</span>
<span style=color:#f92672>import</span> akka.actor.ActorSystem<span style=color:#f92672>;</span>
<span style=color:#f92672>import</span> com.typesafe.config.Config<span style=color:#f92672>;</span>
<span style=color:#f92672>import</span> com.typesafe.config.ConfigFactory<span style=color:#f92672>;</span>

<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>App</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>String<span style=color:#f92672>[]</span> args<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        Config combined <span style=color:#f92672>=</span> ConfigFactory<span style=color:#f92672>.</span><span style=color:#a6e22e>load</span><span style=color:#f92672>();</span>

        Config remote <span style=color:#f92672>=</span> ConfigFactory<span style=color:#f92672>.</span><span style=color:#a6e22e>parseString</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;akka.actor.provider=akka.remote.RemoteActorRefProvider&#34;</span><span style=color:#f92672>);</span>
        combined <span style=color:#f92672>=</span> remote<span style=color:#f92672>.</span><span style=color:#a6e22e>withFallback</span><span style=color:#f92672>(</span>combined<span style=color:#f92672>);</span>

        <span style=color:#75715e>//配置监听地址和端口，hostname可以忽略，默认为本机地址
</span><span style=color:#75715e></span>        Config addressConfig <span style=color:#f92672>=</span> ConfigFactory<span style=color:#f92672>.</span><span style=color:#a6e22e>parseString</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;akka.remote.netty.tcp={hostname=192.168.8.136, port=2553}&#34;</span><span style=color:#f92672>);</span>
        combined <span style=color:#f92672>=</span> addressConfig<span style=color:#f92672>.</span><span style=color:#a6e22e>withFallback</span><span style=color:#f92672>(</span>combined<span style=color:#f92672>);</span>

        <span style=color:#66d9ef>final</span> ActorSystem system <span style=color:#f92672>=</span> ActorSystem<span style=color:#f92672>.</span><span style=color:#a6e22e>create</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;ActorSystemB&#34;</span><span style=color:#f92672>,</span> combined<span style=color:#f92672>);</span>
        ActorSelection selection <span style=color:#f92672>=</span> system<span style=color:#f92672>.</span><span style=color:#a6e22e>actorSelection</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;akka.tcp://ActorSystemA@192.168.8.136:2552/user/ActorA&#34;</span><span style=color:#f92672>);</span>
        selection<span style=color:#f92672>.</span><span style=color:#a6e22e>tell</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;from B&#34;</span><span style=color:#f92672>,</span> ActorRef<span style=color:#f92672>.</span><span style=color:#a6e22e>noSender</span><span style=color:#f92672>());</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>如果一切顺利，那么在 A 的控制台中会看到类似<code>Received String message: from B</code>的消息</p></div><div class="row middle-xs"><div class=col-xs-12></div></div><div class=row><div class=col-xs-12></div></div><div style=height:50px></div><div class=post-comments><div id=disqus_thread></div><script>window.addEventListener("load",()=>{(function(){var d=document,s=d.createElement("script");s.src="https://scottqian.disqus.com/embed.js";s.setAttribute("data-timestamp",+new Date());(d.head||d.body).appendChild(s);})();});</script><noscript>Please enable JavaScript to view the
<a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div><div class=site-footer><div class=site-footer-item><a href=https://github.com/qianlifeng target=_blank>Github</a></div></div></div></div></article><script src=/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>