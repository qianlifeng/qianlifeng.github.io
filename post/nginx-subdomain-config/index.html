<!doctype html><html lang=en><head><meta charset=utf-8><meta name=generator content="Hugo 0.79.1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content><meta property="og:url" content="https://blog.qlf.io/post/nginx-subdomain-config/"><link rel=canonical href=https://blog.qlf.io/post/nginx-subdomain-config/><link rel=preload href=/js/highlight.pack.js as=script><link rel=alternate type=application/atom+xml href=https://blog.qlf.ioindex.xml title=钱李峰的博客><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.qlf.io"},"articleSection":"post","name":"nginx二级域名配置小结","headline":"nginx二级域名配置小结","description":"一直就听说 nginx 很牛逼的样子，这次就在 VPS 上面体验了一把。平常一直混迹于 window 平台下，所以最多也就配配 IIS，而且仅仅限于 UI 这里点点那里点点。使用 nginx 完全是不同的感受，所有配置完全写在配置文件里面，所有东西完全掌控在你手上。极客小伙伴们快来体验一把！\n为了以后查阅起来方便，我决定还是从安装开始写，说不定时间一长我连怎么安装配置 nginx 都会记不得了，正好也给新手一个完全指南。注：我使用的 VPS 系统是 Ubuntu\nnginx 安装 sudo apt-get install nginx too young too simple 啊。装完了之后，有几个常用的目录我们需要认识一下：\n 下面这个路径是存放 domain 配置的地方。默认下面应该有个 default 文件。  \/etc\/nginx\/site-available 如果你有不同的域名 a.com,b.com。那么你就可以在这下面建立 a,b 文件分别对这两个域名进行配置，简单的分类作用吧。我们下面要讲到的规则基本上都是在这里面配置的。\n这个是 nginx 默认的日志存放路径  \/var\/log\/nginx\/ 这里面基本上有两类文件：错误日志error.log,访问日志access.log。后期再配置二级域名的时候，如果配置的不对，过来查看错误日志是很有效的错误定位方法。\n配置二级域名 打开上文提到的\/etc\/nginx\/site-available\/default文件。键入如下代码（scottqian.com 换成你的域名）：\nserver { index index.html; server_name ~^(?\u0026lt;subdomain\u0026gt;.\u002b)\\.scottqian\\.com$; root \/home\/web\/$subdomain\/; if ($host != \u0027www.scottqian.com\u0027){ rewrite ^\/(.*)$ http:\/\/www.scottqian.com\/$1 permanent; } location \/ { try_files $uri $uri\/ =404; } } 注意看server_name那一行。这是一个正则表达式，它匹配所有**.","inLanguage":"en-US","author":"","creator":"","publisher":"","accountablePerson":"","copyrightHolder":"","copyrightYear":"2013","datePublished":"2013-11-08 21:15:17 \u002b0000 UTC","dateModified":"2013-11-08 21:15:17 \u002b0000 UTC","url":"https:\/\/blog.qlf.io\/post\/nginx-subdomain-config\/","keywords":[]}</script><title>nginx二级域名配置小结 - 钱李峰的博客</title><meta property="og:title" content="nginx二级域名配置小结 - 钱李峰的博客"><meta property="og:type" content="article"><meta property="og:description" content="一直就听说 nginx 很牛逼的样子，这次就在 VPS 上面体验了一把。平常一直混迹于 window 平台下，所以最多也就配配 IIS，而且仅仅限于 UI 这里点点那里点点。使用 nginx 完全是不同的感受，所有配置完全写在配置文件里面，所有东西完全掌控在你手上。极客小伙伴们快来体验一把！
为了以后查阅起来方便，我决定还是从安装开始写，说不定时间一长我连怎么安装配置 nginx 都会记不得了，正好也给新手一个完全指南。注：我使用的 VPS 系统是 Ubuntu
nginx 安装 sudo apt-get install nginx too young too simple 啊。装完了之后，有几个常用的目录我们需要认识一下：
 下面这个路径是存放 domain 配置的地方。默认下面应该有个 default 文件。  /etc/nginx/site-available 如果你有不同的域名 a.com,b.com。那么你就可以在这下面建立 a,b 文件分别对这两个域名进行配置，简单的分类作用吧。我们下面要讲到的规则基本上都是在这里面配置的。
这个是 nginx 默认的日志存放路径  /var/log/nginx/ 这里面基本上有两类文件：错误日志error.log,访问日志access.log。后期再配置二级域名的时候，如果配置的不对，过来查看错误日志是很有效的错误定位方法。
配置二级域名 打开上文提到的/etc/nginx/site-available/default文件。键入如下代码（scottqian.com 换成你的域名）：
server { index index.html; server_name ~^(?<subdomain>.+)\.scottqian\.com$; root /home/web/$subdomain/; if ($host != 'www.scottqian.com'){ rewrite ^/(.*)$ http://www.scottqian.com/$1 permanent; } location / { try_files $uri $uri/ =404; } } 注意看server_name那一行。这是一个正则表达式，它匹配所有**."><meta name=description content="一直就听说 nginx 很牛逼的样子，这次就在 VPS 上面体验了一把。平常一直混迹于 window 平台下，所以最多也就配配 IIS，而且仅仅限于 UI 这里点点那里点点。使用 nginx 完全是不同的感受，所有配置完全写在配置文件里面，所有东西完全掌控在你手上。极客小伙伴们快来体验一把！
为了以后查阅起来方便，我决定还是从安装开始写，说不定时间一长我连怎么安装配置 nginx 都会记不得了，正好也给新手一个完全指南。注：我使用的 VPS 系统是 Ubuntu
nginx 安装 sudo apt-get install nginx too young too simple 啊。装完了之后，有几个常用的目录我们需要认识一下：
 下面这个路径是存放 domain 配置的地方。默认下面应该有个 default 文件。  /etc/nginx/site-available 如果你有不同的域名 a.com,b.com。那么你就可以在这下面建立 a,b 文件分别对这两个域名进行配置，简单的分类作用吧。我们下面要讲到的规则基本上都是在这里面配置的。
这个是 nginx 默认的日志存放路径  /var/log/nginx/ 这里面基本上有两类文件：错误日志error.log,访问日志access.log。后期再配置二级域名的时候，如果配置的不对，过来查看错误日志是很有效的错误定位方法。
配置二级域名 打开上文提到的/etc/nginx/site-available/default文件。键入如下代码（scottqian.com 换成你的域名）：
server { index index.html; server_name ~^(?<subdomain>.+)\.scottqian\.com$; root /home/web/$subdomain/; if ($host != 'www.scottqian.com'){ rewrite ^/(.*)$ http://www.scottqian.com/$1 permanent; } location / { try_files $uri $uri/ =404; } } 注意看server_name那一行。这是一个正则表达式，它匹配所有**."><meta property="og:locale" content><link rel=stylesheet href=/css/flexboxgrid-6.3.1.min.css><link rel=stylesheet href=/css/github-markdown.css><link rel=stylesheet href=/css/highlight/tomorrow.min.css><link rel=stylesheet href=/css/index.css><link href=/index.xml rel=alternate type=application/rss+xml title=钱李峰的博客><link href="https://fonts.googleapis.com/css?family=Arvo|Permanent+Marker|Bree+Serif" rel=stylesheet></head><body><article class=post id=article><div class=row><div class=col-xs-12><div class=site-header><header><div class="signatures site-title"><a href=/>Scott Qian</a></div></header><div class="row end-xs"></div><div class=header-line></div></div><header class=post-header><h1 class=post-title>nginx二级域名配置小结</h1><div class="row post-desc"><div class=col-xs-6><time class=post-date datetime="2013-11-08 21:15:17 UTC">08 Nov 2013</time></div><div class=col-xs-6></div></div></header><div class="post-content markdown-body"><p>一直就听说 nginx 很牛逼的样子，这次就在 VPS 上面体验了一把。平常一直混迹于 window 平台下，所以最多也就配配 IIS，而且仅仅限于 UI 这里点点那里点点。使用 nginx 完全是不同的感受，所有配置完全写在配置文件里面，所有东西完全掌控在你手上。极客小伙伴们快来体验一把！</p><p>为了以后查阅起来方便，我决定还是从安装开始写，说不定时间一长我连怎么安装配置 nginx 都会记不得了，正好也给新手一个完全指南。注：我使用的 VPS 系统是 Ubuntu</p><h1 id=nginx-安装>nginx 安装</h1><pre><code>sudo apt-get install nginx
</code></pre><p>too young too simple 啊。装完了之后，有几个常用的目录我们需要认识一下：</p><ol><li>下面这个路径是存放 domain 配置的地方。默认下面应该有个 default 文件。</li></ol><pre><code>/etc/nginx/site-available
</code></pre><p>如果你有不同的域名 a.com,b.com。那么你就可以在这下面建立 a,b 文件分别对这两个域名进行配置，简单的分类作用吧。我们下面要讲到的规则基本上都是在这里面配置的。</p><ol start=2><li>这个是 nginx 默认的日志存放路径</li></ol><pre><code>/var/log/nginx/
</code></pre><p>这里面基本上有两类文件：错误日志<code>error.log</code>,访问日志<code>access.log</code>。后期再配置二级域名的时候，如果配置的不对，过来查看错误日志是很有效的错误定位方法。</p><h1 id=配置二级域名>配置二级域名</h1><p>打开上文提到的<code>/etc/nginx/site-available/default</code>文件。键入如下代码（scottqian.com 换成你的域名）：</p><pre><code>server {
        index index.html;
        server_name ~^(?&lt;subdomain&gt;.+)\.scottqian\.com$;
        root /home/web/$subdomain/;

        if ($host != 'www.scottqian.com'){
                rewrite ^/(.*)$ http://www.scottqian.com/$1 permanent;
        }

        location / {
                try_files $uri $uri/ =404;
        }

}

</code></pre><p>注意看<code>server_name</code>那一行。这是一个正则表达式，它匹配所有**.scottqian.com 的域名，并把**代表的字符用 subdomain 变量表示。紧接着在下面使用<code>root</code>命令，将当前 url 的根地址指向<code>/home/web/$subdomain/</code>。通过这个方式实现了任意多个二级域名的配置，比如你想在又多了一个域名 lab.scottqian.com。那么只需要在<code>/home/web</code>下面建立一个 lab 文件夹即可。完全不必再来更改配置。</p><p>上面那个 if 判断语句是用来将<code>scottqian.com</code>这样的域名重定向为<code>www.scottqian.com</code>。暂时还不能去掉这个判断，因为没有这个的话 subdomain 变量就是空的，到时候根目录就是<code>/home/web//</code>，显然是不对的，我就在这上面吃过亏。</p></div><div class="row middle-xs"><div class=col-xs-12></div></div><div class=row><div class=col-xs-12></div></div><div style=height:50px></div><div class=post-comments><div id=disqus_thread></div><script>window.addEventListener("load",()=>{(function(){var d=document,s=d.createElement("script");s.src="https://scottqian.disqus.com/embed.js";s.setAttribute("data-timestamp",+new Date());(d.head||d.body).appendChild(s);})();});</script><noscript>Please enable JavaScript to view the
<a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div><div class=site-footer><div class=site-footer-item><a href=https://github.com/qianlifeng target=_blank>Github</a></div></div></div></div></article><script src=/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>