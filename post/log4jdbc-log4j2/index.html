<!doctype html><html lang=en><head><meta charset=utf-8><meta name=generator content="Hugo 0.79.1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content><meta property="og:url" content="https://blog.qlf.io/post/log4jdbc-log4j2/"><link rel=canonical href=https://blog.qlf.io/post/log4jdbc-log4j2/><link rel=preload href=/js/highlight.pack.js as=script><link rel=alternate type=application/atom+xml href=https://blog.qlf.ioindex.xml title="Scott Qian"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.qlf.io"},"articleSection":"post","name":"使用log4jdbc-log4j2记录完整的SQL执行语句","headline":"使用log4jdbc-log4j2记录完整的SQL执行语句","description":"平常在使用 Hibernate 的 show_sql 开关的时候，打印出来的 sql 不是真实的 sql，参数都是?。在调试性能的时候比较蛋疼。利用log4jdbc-log4f2可以达到打印完整 SQL 的要求，甚至他还可以打印出执行的结果集\n注意，我这边使用的 logback(slf4j)作为日志记录组件，如果你不是使用的 logback，那么如下方法可能对你不适用，请查看官网文档\n  加入如下 Maven 包：\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.bgee.log4jdbc-log4j2\u0026lt;\/groupId\u0026gt; \u0026lt;artifactId\u0026gt;log4jdbc-log4j2-jdbc4\u0026lt;\/artifactId\u0026gt; \u0026lt;version\u0026gt;1.16\u0026lt;\/version\u0026gt; \u0026lt;\/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.slf4j\u0026lt;\/groupId\u0026gt; \u0026lt;artifactId\u0026gt;slf4j-api\u0026lt;\/artifactId\u0026gt; \u0026lt;version\u0026gt;${slf4j.version}\u0026lt;\/version\u0026gt; \u0026lt;\/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;ch.qos.logback\u0026lt;\/groupId\u0026gt; \u0026lt;artifactId\u0026gt;logback-classic\u0026lt;\/artifactId\u0026gt; \u0026lt;version\u0026gt;${logback.version}\u0026lt;\/version\u0026gt; \u0026lt;\/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.slf4j\u0026lt;\/groupId\u0026gt; \u0026lt;artifactId\u0026gt;log4j-over-slf4j\u0026lt;\/artifactId\u0026gt; \u0026lt;version\u0026gt;${slf4j.version}\u0026lt;\/version\u0026gt; \u0026lt;\/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.slf4j\u0026lt;\/groupId\u0026gt; \u0026lt;artifactId\u0026gt;jcl-over-slf4j\u0026lt;\/artifactId\u0026gt; \u0026lt;version\u0026gt;${slf4j.version}\u0026lt;\/version\u0026gt; \u0026lt;\/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.slf4j\u0026lt;\/groupId\u0026gt; \u0026lt;artifactId\u0026gt;jul-to-slf4j\u0026lt;\/artifactId\u0026gt; \u0026lt;version\u0026gt;${slf4j.version}\u0026lt;\/version\u0026gt; \u0026lt;\/dependency\u0026gt;   更改数据库连接，由原来的\n  jdbc:mysql:\/\/localhost:1527 改为\njdbc:log4jdbc:mysql:\/\/localhost:1527  更改 JDBC Driver，由原来的  com.mysql.jdbc.Driver 改为\nnet.sf.log4jdbc.sql.jdbcapi.DriverSpy  添加 log4jdbc.log4j2.properties 配置文件  log4jdbc.spylogdelegator.name=net.sf.log4jdbc.log.slf4j.Slf4jSpyLogDelegator   最后在 logback.","inLanguage":"en-US","author":"","creator":"","publisher":"","accountablePerson":"","copyrightHolder":"","copyrightYear":"2015","datePublished":"2015-11-17 16:55:17 \u002b0000 UTC","dateModified":"2015-11-17 16:55:17 \u002b0000 UTC","url":"https:\/\/blog.qlf.io\/post\/log4jdbc-log4j2\/","keywords":[]}</script><title>使用log4jdbc-log4j2记录完整的SQL执行语句 - Scott Qian</title><meta property="og:title" content="使用log4jdbc-log4j2记录完整的SQL执行语句 - Scott Qian"><meta property="og:type" content="article"><meta property="og:description" content="平常在使用 Hibernate 的 show_sql 开关的时候，打印出来的 sql 不是真实的 sql，参数都是?。在调试性能的时候比较蛋疼。利用log4jdbc-log4f2可以达到打印完整 SQL 的要求，甚至他还可以打印出执行的结果集
注意，我这边使用的 logback(slf4j)作为日志记录组件，如果你不是使用的 logback，那么如下方法可能对你不适用，请查看官网文档
  加入如下 Maven 包：
<dependency> <groupId>org.bgee.log4jdbc-log4j2</groupId> <artifactId>log4jdbc-log4j2-jdbc4</artifactId> <version>1.16</version> </dependency> <dependency> <groupId>org.slf4j</groupId> <artifactId>slf4j-api</artifactId> <version>${slf4j.version}</version> </dependency> <dependency> <groupId>ch.qos.logback</groupId> <artifactId>logback-classic</artifactId> <version>${logback.version}</version> </dependency> <dependency> <groupId>org.slf4j</groupId> <artifactId>log4j-over-slf4j</artifactId> <version>${slf4j.version}</version> </dependency> <dependency> <groupId>org.slf4j</groupId> <artifactId>jcl-over-slf4j</artifactId> <version>${slf4j.version}</version> </dependency> <dependency> <groupId>org.slf4j</groupId> <artifactId>jul-to-slf4j</artifactId> <version>${slf4j.version}</version> </dependency>   更改数据库连接，由原来的
  jdbc:mysql://localhost:1527 改为
jdbc:log4jdbc:mysql://localhost:1527  更改 JDBC Driver，由原来的  com.mysql.jdbc.Driver 改为
net.sf.log4jdbc.sql.jdbcapi.DriverSpy  添加 log4jdbc.log4j2.properties 配置文件  log4jdbc.spylogdelegator.name=net.sf.log4jdbc.log.slf4j.Slf4jSpyLogDelegator   最后在 logback."><meta name=description content="平常在使用 Hibernate 的 show_sql 开关的时候，打印出来的 sql 不是真实的 sql，参数都是?。在调试性能的时候比较蛋疼。利用log4jdbc-log4f2可以达到打印完整 SQL 的要求，甚至他还可以打印出执行的结果集
注意，我这边使用的 logback(slf4j)作为日志记录组件，如果你不是使用的 logback，那么如下方法可能对你不适用，请查看官网文档
  加入如下 Maven 包：
<dependency> <groupId>org.bgee.log4jdbc-log4j2</groupId> <artifactId>log4jdbc-log4j2-jdbc4</artifactId> <version>1.16</version> </dependency> <dependency> <groupId>org.slf4j</groupId> <artifactId>slf4j-api</artifactId> <version>${slf4j.version}</version> </dependency> <dependency> <groupId>ch.qos.logback</groupId> <artifactId>logback-classic</artifactId> <version>${logback.version}</version> </dependency> <dependency> <groupId>org.slf4j</groupId> <artifactId>log4j-over-slf4j</artifactId> <version>${slf4j.version}</version> </dependency> <dependency> <groupId>org.slf4j</groupId> <artifactId>jcl-over-slf4j</artifactId> <version>${slf4j.version}</version> </dependency> <dependency> <groupId>org.slf4j</groupId> <artifactId>jul-to-slf4j</artifactId> <version>${slf4j.version}</version> </dependency>   更改数据库连接，由原来的
  jdbc:mysql://localhost:1527 改为
jdbc:log4jdbc:mysql://localhost:1527  更改 JDBC Driver，由原来的  com.mysql.jdbc.Driver 改为
net.sf.log4jdbc.sql.jdbcapi.DriverSpy  添加 log4jdbc.log4j2.properties 配置文件  log4jdbc.spylogdelegator.name=net.sf.log4jdbc.log.slf4j.Slf4jSpyLogDelegator   最后在 logback."><meta property="og:locale" content><link rel=stylesheet href=/css/flexboxgrid-6.3.1.min.css><link rel=stylesheet href=/css/github-markdown.css><link rel=stylesheet href=/css/highlight/tomorrow.min.css><link rel=stylesheet href=/css/index.css><link href=/index.xml rel=alternate type=application/rss+xml title="Scott Qian"><link href="https://fonts.googleapis.com/css?family=Arvo|Permanent+Marker|Bree+Serif" rel=stylesheet></head><body><article class=post id=article><div class=row><div class=col-xs-12><div class=site-header><header><div class="signatures site-title"><a href=/>Scott Qian</a></div></header><div class="row end-xs"></div><div class=header-line></div></div><header class=post-header><h1 class=post-title>使用log4jdbc-log4j2记录完整的SQL执行语句</h1><div class="row post-desc"><div class=col-xs-6><time class=post-date datetime="2015-11-17 16:55:17 UTC">17 Nov 2015</time></div><div class=col-xs-6></div></div></header><div class="post-content markdown-body"><p>平常在使用 Hibernate 的 show_sql 开关的时候，打印出来的 sql 不是真实的 sql，参数都是?。在调试性能的时候比较蛋疼。利用<a href=https://code.google.com/p/log4jdbc-log4j2/>log4jdbc-log4f2</a>可以达到打印完整 SQL 的要求，甚至他还可以打印出执行的结果集</p><p><strong>注意，我这边使用的 logback(slf4j)作为日志记录组件，如果你不是使用的 logback，那么如下方法可能对你不适用，请查看官网文档</strong></p><ul><li><p>加入如下 Maven 包：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;dependency&gt;</span>
  <span style=color:#f92672>&lt;groupId&gt;</span>org.bgee.log4jdbc-log4j2<span style=color:#f92672>&lt;/groupId&gt;</span>
  <span style=color:#f92672>&lt;artifactId&gt;</span>log4jdbc-log4j2-jdbc4<span style=color:#f92672>&lt;/artifactId&gt;</span>
  <span style=color:#f92672>&lt;version&gt;</span>1.16<span style=color:#f92672>&lt;/version&gt;</span>
<span style=color:#f92672>&lt;/dependency&gt;</span>

<span style=color:#f92672>&lt;dependency&gt;</span>
    <span style=color:#f92672>&lt;groupId&gt;</span>org.slf4j<span style=color:#f92672>&lt;/groupId&gt;</span>
    <span style=color:#f92672>&lt;artifactId&gt;</span>slf4j-api<span style=color:#f92672>&lt;/artifactId&gt;</span>
    <span style=color:#f92672>&lt;version&gt;</span>${slf4j.version}<span style=color:#f92672>&lt;/version&gt;</span>
<span style=color:#f92672>&lt;/dependency&gt;</span>

<span style=color:#f92672>&lt;dependency&gt;</span>
    <span style=color:#f92672>&lt;groupId&gt;</span>ch.qos.logback<span style=color:#f92672>&lt;/groupId&gt;</span>
    <span style=color:#f92672>&lt;artifactId&gt;</span>logback-classic<span style=color:#f92672>&lt;/artifactId&gt;</span>
    <span style=color:#f92672>&lt;version&gt;</span>${logback.version}<span style=color:#f92672>&lt;/version&gt;</span>
<span style=color:#f92672>&lt;/dependency&gt;</span>

<span style=color:#f92672>&lt;dependency&gt;</span>
    <span style=color:#f92672>&lt;groupId&gt;</span>org.slf4j<span style=color:#f92672>&lt;/groupId&gt;</span>
    <span style=color:#f92672>&lt;artifactId&gt;</span>log4j-over-slf4j<span style=color:#f92672>&lt;/artifactId&gt;</span>
    <span style=color:#f92672>&lt;version&gt;</span>${slf4j.version}<span style=color:#f92672>&lt;/version&gt;</span>
<span style=color:#f92672>&lt;/dependency&gt;</span>
<span style=color:#f92672>&lt;dependency&gt;</span>
    <span style=color:#f92672>&lt;groupId&gt;</span>org.slf4j<span style=color:#f92672>&lt;/groupId&gt;</span>
    <span style=color:#f92672>&lt;artifactId&gt;</span>jcl-over-slf4j<span style=color:#f92672>&lt;/artifactId&gt;</span>
    <span style=color:#f92672>&lt;version&gt;</span>${slf4j.version}<span style=color:#f92672>&lt;/version&gt;</span>
<span style=color:#f92672>&lt;/dependency&gt;</span>
<span style=color:#f92672>&lt;dependency&gt;</span>
    <span style=color:#f92672>&lt;groupId&gt;</span>org.slf4j<span style=color:#f92672>&lt;/groupId&gt;</span>
    <span style=color:#f92672>&lt;artifactId&gt;</span>jul-to-slf4j<span style=color:#f92672>&lt;/artifactId&gt;</span>
    <span style=color:#f92672>&lt;version&gt;</span>${slf4j.version}<span style=color:#f92672>&lt;/version&gt;</span>
<span style=color:#f92672>&lt;/dependency&gt;</span>
</code></pre></div></li><li><p>更改数据库连接，由原来的</p></li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml> jdbc:mysql://localhost:1527
</code></pre></div><p>改为</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml> jdbc:log4jdbc:mysql://localhost:1527
</code></pre></div><ul><li>更改 JDBC Driver，由原来的</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml>com.mysql.jdbc.Driver
</code></pre></div><p>改为</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml>net.sf.log4jdbc.sql.jdbcapi.DriverSpy
</code></pre></div><ul><li>添加 log4jdbc.log4j2.properties 配置文件</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=color:#a6e22e>log4jdbc.spylogdelegator.name</span><span style=color:#f92672>=</span><span style=color:#e6db74>net.sf.log4jdbc.log.slf4j.Slf4jSpyLogDelegator</span>
</code></pre></div><ul><li><p>最后在 logback.xml 加入如下 appender</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;logger</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;jdbc.sqltiming&#34;</span> <span style=color:#a6e22e>level=</span><span style=color:#e6db74>&#34;DEBUG&#34;</span> <span style=color:#f92672>/&gt;</span>
<span style=color:#f92672>&lt;logger</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;jdbc.resultsettable&#34;</span> <span style=color:#a6e22e>level=</span><span style=color:#e6db74>&#34;DEBUG&#34;</span> <span style=color:#f92672>/&gt;</span>
<span style=color:#f92672>&lt;logger</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;jdbc.resultset&#34;</span> <span style=color:#a6e22e>level=</span><span style=color:#e6db74>&#34;WARN&#34;</span> <span style=color:#f92672>/&gt;</span>
<span style=color:#f92672>&lt;logger</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;jdbc.audit&#34;</span> <span style=color:#a6e22e>level=</span><span style=color:#e6db74>&#34;WARN&#34;</span> <span style=color:#f92672>/&gt;</span>
</code></pre></div><p>log4jdbc-log4j2 支持如下几种 appender</p></li></ul><table><thead><tr><th>logger</th><th>description</th></tr></thead><tbody><tr><td>jdbc.sqlonly</td><td>Logs only SQL. SQL executed within a prepared statement is automatically shown with it&rsquo;s bind arguments replaced with the data bound at that position, for greatly increased readability.</td></tr><tr><td>jdbc.sqltiming</td><td>Logs the SQL, post-execution, including timing statistics on how long the SQL took to execute.</td></tr><tr><td>jdbc.audit</td><td>Logs ALL JDBC calls except for ResultSets. This is a very voluminous output, and is not normally needed unless tracking down a specific JDBC problem.</td></tr><tr><td>jdbc.resultset</td><td>Even more voluminous, because all calls to ResultSet objects are logged.</td></tr><tr><td>jdbc.resultsettable</td><td>Log the jdbc results as a table. Level debug will fill in unread values in the result set.</td></tr><tr><td>jdbc.connection</td><td>Logs connection open and close events as well as dumping all open connection numbers. This is very useful for hunting down connection leak problems.</td></tr></tbody></table></div><div class="row middle-xs"><div class=col-xs-12></div></div><div class=row><div class=col-xs-12></div></div><div style=height:50px></div><div class=post-comments><div id=disqus_thread></div><script>window.addEventListener("load",()=>{(function(){var d=document,s=d.createElement("script");s.src="https://scottqian.disqus.com/embed.js";s.setAttribute("data-timestamp",+new Date());(d.head||d.body).appendChild(s);})();});</script><noscript>Please enable JavaScript to view the
<a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div><div class=site-footer><div class=site-footer-item><a href=https://github.com/qianlifeng target=_blank>Github</a></div></div></div></div></article><script src=/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>